// ===== DATOS DE PRODUCTOS =====
const products = [


       {
    id: 17,
    name: "Vestido Armani Talla Unica",
    price: 6,
    category: "Vestido",
    images: [
     "https://i.ibb.co/NngpP84t/ml1.jpg",
      "https://i.ibb.co/7xYX5d75/ml3.jpg",
      "https://i.ibb.co/d022QNFL/ml2.jpg",
      "https://i.ibb.co/KxybWsPk/ml4.jpg",
      "https://i.ibb.co/4RCP9Hbg/ml.jpg" 
    ],
    
    badge: "sale",
    originalPrice: 8,
    sizes: ["40","41","42","43","44"],
    colors: ["black","white"]
  },


       {
    id: 10,
    name: "Franelas para Damas",
    price: 7,
    category: "Franela de dama",
    images: [
     "https://i.ibb.co/PvD70Y9G/Captura-de-pantalla-2026-02-26-10153322.jpg",
      "https://i.ibb.co/23w9nNnV/4dbe84eb-2a97-4727-8354-2573a17320ee.jpg" ,
      "https://i.ibb.co/TDTJ8Kdr/Captura-de-pantalla-2026-02-26-101753s.jpg",
      "https://i.ibb.co/QFW2M5DJ/a90c542d-79b4-491e-b347-e32e544cde71.jpg" 
    ],
    
    badge: "sale",
    originalPrice: 10,
    sizes: ["40","41","42","43","44"],
    colors: ["black","white"]
  },


    {
    id: 15,
    name: "Ropa para Dormir",
    price:6,
    category: "Dormilona",
    images: [
     "https://i.ibb.co/ym7Tw5XZ/79b79a59-701d-45d3-b5d8-8081817d3f13.jpg",
      "https://i.ibb.co/pBxLKM6W/25faa34f-6ae9-4469-85a8-0260e0aacb81.jpg" ,
      
      "https://i.ibb.co/twq9WdR0/f933fb64-9e2b-40d1-ac07-9bc81ed1e231.jpg"
    ],
    
    badge: "sale",
    originalPrice: 15,
    sizes: ["40","41","42","43","44"],
    colors: ["black","white"]
  },


     {
    id: 14,
    name: "Pantalon para Damas",
    price: 10,
    category: "Pantalon",
    images: [
     "https://i.ibb.co/VW90sR0j/ddab8ed7-bf8a-46ed-a935-62aa7334ec4d-1.jpg",
      "https://i.ibb.co/4wtRxGcS/rosado.jpg" ,
      "https://i.ibb.co/23bzhpVV/e3406712-661e-4cd0-8cd9-08ef1f333d21.jpg",
      "https://i.ibb.co/3yXwK8TV/ddab8ed7-bf8a-46ed-a935-62aa7334ec4d.jpg"
    ],
    
    badge: "sale",
    originalPrice: 15,
    sizes: ["40","41","42","43","44"],
    colors: ["black","white"]
  },
  
   {
    id: 13,
    name: "Conjuntos Gucci Plus",
    price: 12,
    category: "conjunto",
    images: [
      "https://i.ibb.co/FbXCnkBG/44458a02-cfd3-4dca-aa7a-5cb453dfa28f.jpg" ,
      "https://i.ibb.co/gZ0Hw89N/02b0662b-eb4a-4ea9-8dfa-28e66ea86847.jpg" ,
      "https://i.ibb.co/cc255MHQ/3866d8fe-9c4a-42a3-bedf-97f626670b80.jpg",
      "https://i.ibb.co/C319GZF6/12259787-b3c7-4357-ae4c-15d6d39ddaea.jpg"
    ],
    
    badge: "sale",
    originalPrice: 23,
    sizes: ["40","41","42","43","44"],
    colors: ["black","white"]
  },

  
  
  
  
  
   {
    id: 12,
    name: "Conjuntos de dama",
    price: 19,
    category: "Mono",
    images: [
      "https://i.ibb.co/twDp8BPW/cv1.jpg",
      "https://i.ibb.co/R43W1DN8/cv2.jpg",
      "https://i.ibb.co/C3grrFLw/cv4.jpg",
      "https://i.ibb.co/9Hvm62wq/cv3.jpg" 
    ],
    
    badge: "sale",
    originalPrice: 23,
    sizes: ["40","41","42","43","44"],
    colors: ["black","white"]
  },

  
  
  {
    id: 11,
    name: "Vestido de dama Elegante",
    price: 16,
    category: "vestido",
    images: [
      "https://i.ibb.co/gbdyrvNx/7c5f7054-20fa-43f4-9537-3b4f973b5b21.jpg",
      "https://i.ibb.co/FkMX2ynY/32d0c2fd-f2f2-4c51-8562-e797b8722f80.jpg",
      "https://i.ibb.co/23YYc9Fs/715fe127-f8e4-4049-828e-73d3635a0bfd.jpg",
      "https://i.ibb.co/ccDTXQjL/cb5fc80e-65a3-46fb-81c4-caeb2f9512ab.jpg",
      "https://i.ibb.co/GfgfDLK6/d9754245-604a-4acc-ac69-654bc8ec079d.jpg"  
    ],
    
  
    colors: ["black","white"]
    
  },

  {
    id: 10,
    name: "Vestido de dama Elegante",
    price: 16,
    category: "vestido",
    images: [
      "https://i.ibb.co/JWwxJ7QQ/4a2c3285-b85f-4df6-889a-2d42ff929e8f.jpg", 
      "https://i.ibb.co/N2HCnysF/f7b924bb-f2a3-4a5a-812e-732581e5d3bc.jpg",
      "https://i.ibb.co/XxcqB87f/6e38e6e4-b15c-4f54-a8c4-3f39baf7d908.jpg",
      "https://i.ibb.co/JWwxJ7QQ/4a2c3285-b85f-4df6-889a-2d42ff929e8f.jpg",
      "https://i.ibb.co/kVdz9R3c/e148db39-0964-4e80-9359-55b8a98bbc72.jpg"
    ],
    
  
    colors: ["black","white"]
  },
  

  {
    id: 9,
    name: "Franela de Algodon",
    price: 10,
    category: "mujer",
    images: [
      "https://i.ibb.co/BKtk7J9t/r1.jpg",
      "https://i.ibb.co/FqCHC54N/8f80029a-e837-4232-99e0-36ae9a77b4a7.jpg",
      "https://i.ibb.co/j0MtnS0/r2.jpg",
      "https://i.ibb.co/7x7s62Vz/r3.jpg"
      
      
    ],
    badge: "new",
    sizes: ["S","M","L","XL"],
    colors: ["blue","black"]
  },
  {
    id: 8,
    name: "Franelas Deportiva",
    price: 6,
    category: "hombre",
    images: [
      "https://i.ibb.co/SwwcFfbs/n1.jpg",
      "https://i.ibb.co/wFgF1Q9H/n2.jpg",
      "https://i.ibb.co/ymcJMn4t/n3.jpg",
      "https://i.ibb.co/j9rskcBK/n4.jpg"
    ],
    badge: "sale",
    originalPrice: 10,
    sizes: ["XS","S","M"],
    colors: ["white","brown"]
  },
  {
    id: 7,
    name: "Blusa de Dama Con Piedreria",
    price: 8,
    category: "Mujer",
    images: [
      "https://i.ibb.co/JwgDLhK0/6af0ecb9-39e0-46f8-84df-e1e1c0fd6edb.jpg",
     "https://i.ibb.co/Cs5pgThF/b6694e6c-b7ea-45a8-9ac9-97d7eba3e254.jpg" ,
      "https://i.ibb.co/LDvJctz1/b2dcd5bc-306a-4efb-9666-2002e48d9bc6.jpg" 
    ],
    sizes: ["M","L","XL","XXL"],
    colors: ["white","blue","black"]
  },
  {
    id: 6,
    name: "Vestido de Dama",
    price: 18,
    category: "Mujer",
    images: [
      "https://i.ibb.co/SDG7YjD4/J2.jpg" ,
      "https://i.ibb.co/FLndCCsX/J3.jpg" ,
      "https://i.ibb.co/q36QkYpH/J4.jpg",
      "https://i.ibb.co/YBS1c5Md/J1.jpg" 
    ],
    badge: "new",
    sizes: ["4","6","8","10"],
    colors: ["blue","green"]
  },

  {
    id: 5,
    name: "Licra de Dama",
    price: 6,
    category: "Mujer",
    images: [
      "https://i.ibb.co/G4Mxfz5b/L1.jpg" ,
      "https://i.ibb.co/m5n8m9Sm/L3.jpg" ,
      "https://i.ibb.co/whPCGHYq/2baaf6af-5b26-4817-bbf2-cda5fb625bcc.jpg" ,
      "https://i.ibb.co/BHjZGvyG/L2.jpg"
    ],
    badge: "new",
    sizes: ["4","6","8","10"],
    colors: ["blue","green"]
  },
  {
    id: 4,
    name: "Conjuntos para Niñas",
    price: 6,
    category: "Niñas",
    images: [
      "https://i.ibb.co/BKwdwB6Y/5e477ec4-bfa7-4c6b-983b-f0f20eac407c.jpg" ,
      "https://i.ibb.co/RTjRpCpf/00ccad0c-3704-4896-8184-847917e7c063.jpg" ,
      "https://i.ibb.co/vvTWFNH5/3a7a1c9c-6417-4b43-b57b-ee45145412fd.jpg" 
    ],
     badge: "sale",
    originalPrice: 9,
    sizes: ["40","41","42","43","44"],
    colors: ["brown","black"]
  },
  {
    id: 3,
    name: "Conjuntos para Niños",
    price: 6,
    category: "Niños",
    images: [
      
      "https://i.ibb.co/Z1641f8C/3b75a748-999a-43d1-89fb-284bed39d093.jpg",
      "https://i.ibb.co/0yHn7vqZ/75e83fdf-7afb-4898-a7c1-58b78979fca4.jpg" 
    ],
    
    badge: "sale",
    originalPrice: 9,
    sizes: ["40","41","42","43","44"],
    colors: ["black","white"]
  },
  
  {
    id: 1,
    name: "Frannela micro durazno",
    price: 6,
    category: "Franela",
    images: [
      "https://i.ibb.co/SwSLfJn2/s1.jpg",
      "https://i.ibb.co/x8MvVnGz/s2.jpg",
      "https://i.ibb.co/84MV0y7T/s5.jpg",
      "https://i.ibb.co/qYYLp1bm/s3.jpg" 
    ],
    
    badge: "sale",
    originalPrice: 9,
    sizes: ["40","41","42","43","44"],
    colors: ["black","white"]
  },
  
   
  
];

// ===== ESTADO GLOBAL =====
let state = {
  adminMode: false,
  cart: [],
  currentFilters: {
    categories: [],
    maxPrice: 500,
    sizes: [],
    colors: []
  }
};

// ===== INICIALIZACIÓN =====
document.addEventListener('DOMContentLoaded', () => {
  renderProducts();
  setupEventListeners();
  updateCartCount();
});

// ===== RENDERIZAR PRODUCTOS =====
function renderProducts(filteredProducts = products) {
  const grid = document.getElementById('productsGrid');
  grid.innerHTML = '';

  filteredProducts.forEach(product => {
    const card = document.createElement('article');
    card.className = 'product-card fade-in';
    card.dataset.category = product.category;
    card.dataset.price = product.price;
    
    // Badge
    const badge = product.badge 
      ? `<span class="product-badge badge-${product.badge}">${product.badge === 'sale' ? 'OFERTA' : 'NUEVO'}</span>` 
      : '';

    // Carrusel de imágenes
    const carouselImages = product.images.map((img, i) => 
      `<img src="${img}" alt="${product.name} - Vista ${i+1}" loading="lazy">`
    ).join('');

    // Precio
    const priceDisplay = product.badge === 'sale' && product.originalPrice
      ? `<span class="price-original" style="text-decoration:line-through;color:var(--gray);font-size:0.95rem">$${product.originalPrice.toFixed(2)}</span>
         <span class="price-value">$${product.price.toFixed(2)}</span>`
      : `<span class="price-value">$${product.price.toFixed(2)}</span>`;

    card.innerHTML = `
      ${badge}
      <div class="product-images">
        <div class="product-carousel" id="carousel-${product.id}">
          ${carouselImages}
        </div>
        <button class="carousel-btn prev" data-product="${product.id}" data-dir="prev">
          <i class="fas fa-chevron-left"></i>
        </button>
        <button class="carousel-btn next" data-product="${product.id}" data-dir="next">
          <i class="fas fa-chevron-right"></i>
        </button>
        <div class="carousel-nav" id="dots-${product.id}">
          ${product.images.map((_, i) => 
            `<span class="carousel-dot ${i === 0 ? 'active' : ''}" data-index="${i}"></span>`
          ).join('')}
        </div>
      </div>
      <div class="product-info">
        <h3 class="product-name">${product.name}</h3>
        <div class="product-price">
          ${priceDisplay}
          <div class="price-edit">
            <input type="number" step="0.01" value="${product.price}" data-product-id="${product.id}">
            <button class="btn-save-price" data-product-id="${product.id}"><i class="fas fa-check"></i></button>
          </div>
        </div>
        <button class="btn-edit-price" data-product-id="${product.id}">
          <i class="fas fa-pen"></i> Editar precio
        </button>
        <button class="btn-add-cart" data-product-id="${product.id}">
          <i class="fas fa-cart-plus"></i> Agregar al carrito
        </button>
      </div>
    `;
    grid.appendChild(card);
  });

  // Inicializar carruseles
  initCarousels();
}

// ===== CARRUSEL DE IMÁGENES =====
function initCarousels() {
  document.querySelectorAll('.product-carousel').forEach(carousel => {
    const productId = carousel.id.split('-')[1];
    const dots = document.querySelectorAll(`#dots-${productId} .carousel-dot`);
    const prevBtn = document.querySelector(`.carousel-btn.prev[data-product="${productId}"]`);
    const nextBtn = document.querySelector(`.carousel-btn.next[data-product="${productId}"]`);
    let currentIndex = 0;
    const totalImages = carousel.children.length;

    function goToSlide(index) {
      carousel.style.transform = `translateX(-${index * 100}%)`;
      dots.forEach((dot, i) => dot.classList.toggle('active', i === index));
      currentIndex = index;
    }

    dots.forEach(dot => {
      dot.addEventListener('click', () => goToSlide(parseInt(dot.dataset.index)));
    });

    prevBtn?.addEventListener('click', (e) => {
      e.stopPropagation();
      goToSlide((currentIndex - 1 + totalImages) % totalImages);
    });

    nextBtn?.addEventListener('click', (e) => {
      e.stopPropagation();
      goToSlide((currentIndex + 1) % totalImages);
    });
  });
}

// ===== EVENT LISTENERS =====
function setupEventListeners() {
  // Toggle admin mode
  document.getElementById('adminToggle').addEventListener('click', () => {
    state.adminMode = !state.adminMode;
    document.body.classList.toggle('admin-mode', state.adminMode);
    document.getElementById('adminToggle').innerHTML = 
      `<i class="fas fa-${state.adminMode ? 'check' : 'cog'}"></i>`;
  });

  // Editar precio
  document.addEventListener('click', (e) => {
    if (e.target.closest('.btn-edit-price')) {
      const btn = e.target.closest('.btn-edit-price');
      const productId = parseInt(btn.dataset.productId);
      const product = products.find(p => p.id === productId);
      const input = btn.parentElement.querySelector('input');
      input.value = product.price;
      input.focus();
    }
    
    if (e.target.closest('.btn-save-price')) {
      const btn = e.target.closest('.btn-save-price');
      const productId = parseInt(btn.dataset.productId);
      const input = btn.parentElement.querySelector('input');
      const newPrice = parseFloat(input.value);
      
      if (!isNaN(newPrice) && newPrice >= 0) {
        const product = products.find(p => p.id === productId);
        product.price = newPrice;
        renderProducts(filterProducts());
        showNotification('✅ Precio actualizado');
      }
    }
  });

  // Agregar al carrito
  document.addEventListener('click', (e) => {
    if (e.target.closest('.btn-add-cart')) {
      const btn = e.target.closest('.btn-add-cart');
      const productId = parseInt(btn.dataset.productId);
      addToCart(productId);
    }
  });

  // Carrito modal
  document.getElementById('cartBtn').addEventListener('click', () => {
    document.getElementById('cartModal').classList.add('active');
    renderCart();
  });
  document.getElementById('closeCart').addEventListener('click', () => {
    document.getElementById('cartModal').classList.remove('active');
  });

  // Filtros móvil
  document.getElementById('openFilters').addEventListener('click', () => {
    document.getElementById('filtersSidebar').classList.add('active');
  });
  document.getElementById('closeFilters').addEventListener('click', () => {
    document.getElementById('filtersSidebar').classList.remove('active');
  });

  // Rango de precio
  const priceRange = document.getElementById('priceRange');
  const priceValue = document.getElementById('priceValue');
  priceRange?.addEventListener('input', (e) => {
    priceValue.textContent = `$${e.target.value}`;
    state.currentFilters.maxPrice = parseInt(e.target.value);
  });

  // Aplicar filtros
  document.getElementById('applyFilters')?.addEventListener('click', () => {
    // Categorías
    state.currentFilters.categories = Array.from(
      document.querySelectorAll('input[name="category"]:checked')
    ).map(cb => cb.value);
    
    // Tallas
    state.currentFilters.sizes = Array.from(
      document.querySelectorAll('.size-btn.active')
    ).map(btn => btn.textContent);
    
    // Colores
    state.currentFilters.colors = Array.from(
      document.querySelectorAll('.color-btn.active')
    ).map(btn => btn.dataset.color);

    document.getElementById('filtersSidebar').classList.remove('active');
    renderProducts(filterProducts());
  });

  // Búsqueda
  document.getElementById('searchInput')?.addEventListener('input', (e) => {
    const term = e.target.value.toLowerCase().trim();
    const filtered = products.filter(p => 
      p.name.toLowerCase().includes(term) || 
      p.category.toLowerCase().includes(term)
    );
    renderProducts(filtered);
  });

  // Cerrar modales al hacer clic fuera
  document.getElementById('cartModal')?.addEventListener('click', (e) => {
    if (e.target.id === 'cartModal') {
      document.getElementById('cartModal').classList.remove('active');
    }
  });
}

// ===== FILTRAR PRODUCTOS =====
function filterProducts() {
  return products.filter(product => {
    const { categories, maxPrice, sizes, colors } = state.currentFilters;
    
    if (categories.length && !categories.includes(product.category)) return false;
    if (product.price > maxPrice) return false;
    if (sizes.length && !product.sizes?.some(s => sizes.includes(s))) return false;
    if (colors.length && !product.colors?.some(c => colors.includes(c))) return false;
    
    return true;
  });
}

// ===== CARRITO =====
function addToCart(productId) {
  const product = products.find(p => p.id === productId);
  if (!product) return;

  const existing = state.cart.find(item => item.id === productId);
  if (existing) {
    existing.quantity += 1;
  } else {
    state.cart.push({ ...product, quantity: 1 });
  }
  
  updateCartCount();
  showNotification(`✅ "${product.name}" agregado al carrito`);
}

function updateCartCount() {
  const count = state.cart.reduce((sum, item) => sum + item.quantity, 0);
  document.querySelector('.cart-count').textContent = count;
}

function renderCart() {
  const container = document.getElementById('cartItems');
  const totalEl = document.getElementById('cartTotal');
  
  if (state.cart.length === 0) {
    container.innerHTML = '<p style="text-align:center;color:var(--gray);padding:2rem">Tu carrito está vacío</p>';
    totalEl.textContent = '$0.00';
    return;
  }

  container.innerHTML = state.cart.map(item => `
    <div class="cart-item">
      <img src="${item.images[0]}" alt="${item.name}">
      <div class="cart-item-info">
        <div class="cart-item-name">${item.name}</div>
        <div class="cart-item-price">$${item.price.toFixed(2)} x ${item.quantity}</div>
      </div>
      <div style="font-weight:600">$${(item.price * item.quantity).toFixed(2)}</div>
    </div>
  `).join('');

  const total = state.cart.reduce((sum, item) => sum + item.price * item.quantity, 0);
  totalEl.textContent = `$${total.toFixed(2)}`;
}

// ===== NOTIFICACIONES =====
function showNotification(message) {
  const notification = document.createElement('div');
  notification.style.cssText = `
    position: fixed;
    bottom: 2rem;
    right: 2rem;
    background: var(--primary);
    color: white;
    padding: 1rem 1.5rem;
    border-radius: 10px;
    box-shadow: var(--shadow-hover);
    z-index: 3000;
    animation: slideIn 0.3s ease, fadeOut 0.3s ease 2.7s forwards;
  `;
  notification.textContent = message;
  document.body.appendChild(notification);
  
  setTimeout(() => notification.remove(), 3000);
}

// Agregar animaciones CSS dinámicamente
const style = document.createElement('style');
style.textContent = `
  @keyframes slideIn {
    from { transform: translateX(100px); opacity: 0; }
    to { transform: translateX(0); opacity: 1; }
  }
  @keyframes fadeOut {
    from { opacity: 1; transform: translateY(0); }
    to { opacity: 0; transform: translateY(20px); }
  }
`;
document.head.appendChild(style);